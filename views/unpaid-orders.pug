extends templates/default

mixin orderRow(order)
	tr(onclick="orderSelected('"+order._id+"', event)")
		td=order.orderId
		td=order.customer.name
		td(data-sort=moment(order.orderDate))=moment(order.orderDate).format('MMM Do')
		td(data-sort=moment(order.dueDate))=moment(order.dueDate).format('MMM Do')
		td=order.customer.companyName
		td='$' + order.orderValue.toFixed(2)
		td=order.cartOrder.BillingPaymentMethod
		td=order.reasonForHold

append head
	title Unpaid Orders

append nav-items-right
	button.btn.btn-primary(type="button")#crossCheckButton Cross Check in QB

append body
	.container-fluid
		.row
			.col
				h2 US Orders
				p.lead='There are ' + usOrders.length + ' orders that need payment.'
				table.table.table-striped.table-hover#usOrderTable
					thead
						tr
							th Order ID
							th Name
							th Date
							th Due Date
							th Company
							th Value
							th Payment Method
							th Reason for Hold

					tbody
						each order in usOrders
							+orderRow(order)

		.row.pt-2
			.col
				h2 Canadian Orders
				p.lead='There are ' + canOrders.length + ' orders that need payment.'
				table.table.table-striped.table-hover#canOrderTable
					thead
						tr
							th Order ID
							th Name
							th Date
							th Due Date
							th Company
							th Value
							th Payment Method
							th Reason for Hold

					tbody
						each order in canOrders
							+orderRow(order)

	script.
		socket = io();
		$('#usOrderTable').DataTable({
			bDestroy: true,
			pageLength: 20,
			order: [[2, 'desc']]
		});

		$('#canOrderTable').DataTable({
			bDestroy: true,
			pageLength: 20,
			order: [[2, 'desc']]
		});

		function orderSelected(id, e) {
			if (e.target.localName != 'a') {
				window.open("/order?id="+id, '_blank');
			}
		}

		$(document).ready(e => {
			$('#crossCheckButton').click(e => {
				socket.emit('crossCheckUnpaidOrders', response => {
					alert(response);
				});
			});
		});