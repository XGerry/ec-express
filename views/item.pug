mixin orderTableRow(order)
	tr(onclick="window.location='/order?id="+order._id+"';")
		td=order.orderId
		td=order.name
		td=order.picked ? 'yes' : 'no'
		td=order.invoiced ? 'yes' : 'no'
		td=order.paid ? 'yes' : 'no'

doctype html
include mixins
html
	include includes/head
		title=item.sku
	body
		#wrapper
			+sidebarNav("orders")
			#page-content
				nav.navbar.navbar-light.bg-light.navbar-expand-sm.sticky-top
					button.btn.btn-secondary.btn-toggles(type="button").m-0.position-relative#left-menu-toggle
						i.far.fa-bars.fa-fw
					span.navbar-brand.mb-0.h1.pl-2=item.sku
					//form.form-inline
						select.form-control#orderStatus
							option(value=1) New
							option(value=2) Processing
							option(value=3) Backorder
							option(value=6) Pre-order
							option(value=9) Awaiting Payment
							option(value=13) Awaiting Shipment
							option(value=4) Shipped
					span.navbar-text#orderInfo.ml-2
					ul.navbar-nav.ml-auto
						li.dropdown.nav-item
							a.nav-link.dropdown-toggle(href="#" aria-haspopup="true" data-toggle="dropdown") Actions
							ul.dropdown-menu.dropdown-menu-right
								//- a(href="https://www.ecstasycrafts." + (order.canadian ? "ca" : "com") + "/admin/order_details.asp?orderid="+order.cartOrder.OrderID target="_blank").dropdown-item View on 3D Cart
								//- a(href="/shipping-label?id="+order._id target="_blank").dropdown-item White Label
								//- a(href="#").dropdown-item#removeFromBatchButton Remove from Batch
								a(href=item.usLink target="_blank").dropdown-item US Site
								a(href=item.canLink, target="_blank").dropdown-item Canadian Site
								a#refreshFrom3DCart(href="#").dropdown-item Refresh from 3D Cart
								.dropdown-divider
								a#deleteItem(href="#").dropdown-item.bg-danger.text-white Delete Item
						//button.btn-primary.btn.mr-2(type="button")#addItemButton Add Item
						.btn-group
							button.btn.btn-success(type="button")#saveOrderButton Save
							button.btn.btn-success.dropdown-toggle.dropdown-toggle-split(type="button" data-toggle="dropdown")
							.dropdown-menu.dropdown-menu-right
								a.dropdown-item(href="#")#updateQuickbooks Update in QB
								a.dropdown-item(href="#")#invoiceOrder Invoice Order

				.container.pt-3
					.row
						.col-4
							-
								var imgSrc = item.imageURL;
								if (!imgSrc) {
									imgSrc = 'https://via.placeholder.com/400x400';
								} else {
									if (!imgSrc.startsWith('http')) {
										imgSrc = 'https://www.ecstasycrafts.com/'+imgSrc;
									}
								}
							img.img-fluid(src=imgSrc)
						.col-8
							.row
								.col
									h3=item.name
									p!=item.description
							.row
								.col
									h5 Inventory
									table.table-sm.table
										thead
											th QB Stock
											th Online Stock
											th On Sales Orders
											th On Purchase Orders
										tbody
											td=item.stock
											td=item.usStock
											td=item.onSalesOrders
											if (item.onPurchaseOrders)
												td=item.onPurchaseOrders
											else
												td N/A
							.row
								.col
									h5 Pricing
									table.table-sm.table
										thead
											th US Cost
											th US Price
											th US Wholesale
											th CA Price
											th CA Wholesale
										tbody
											if (item.cost)
												td='$'+item.cost.toFixed(2)
											else
												td N/A
											td='$'+item.usPrice.toFixed(2)
											td='$'+item.usWholesalePrice.toFixed(2)
											td='$'+item.canPrice.toFixed(2)
											td='$'+item.canWholesalePrice.toFixed(2)
							.row
								.col

							.row
								.col
									.form-group
										label Barcode
										input.form-control(type="text" value=item.barcode)
								.col
									.form-group
										label Location
										input.form-control(type="text" value=item.location)
								.col
									.form-group
										label Second Location
										input.form-control(type="text" value=item.secondLocation)


					.row.pt-2
						h2 Orders
						table.table-hover.table.table-striped
							thead
								th Order ID
								th Name
								th Picked
								th Invoiced
								th Paid
							tbody
								each order in orders
									+orderTableRow(order)
		+footer
		script.
			var socket = io();
			var theItem = !{JSON.stringify(item)};
			$(document).ready(e => {
				$('#refreshFrom3DCart').click(e => {
					e.preventDefault();
					socket.emit('refreshItem', theItem, cb => {
						location.reload();
					});
				});
			});