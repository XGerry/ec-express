mixin billingAddress(order)
	address
		h3 Billing
		strong=order.BillingFirstName + " " + order.BillingLastName
		br
		if (order.BillingCompany)
			strong=order.BillingCompany
			br 
		=order.BillingAddress
		br
		if (order.BillingAddress2)
			=order.BillingAddress2
			br
		=order.BillingCity + ", " + order.BillingState
		br
		=order.BillingCountry + ", " + order.BillingZipCode

mixin shippingAddress(shippingInfo)
	address
		h3 Shipping
		strong=shippingInfo.ShipmentFirstName + " " + shippingInfo.ShipmentLastName
		br
		if (shippingInfo.ShipmentCompany)
			strong=shippingInfo.ShipmentCompany
			br
		=shippingInfo.ShipmentAddress
		br
		if (shippingInfo.ShipmentAddress2)
			=shippingInfo.ShipmentAddress2
			br
		=shippingInfo.ShipmentCity + ", " + shippingInfo.ShipmentState
		br
		=shippingInfo.ShipmentCountry + ", " + shippingInfo.ShipmentZipCode

mixin pickTableRow(item)
	tr
		td= item.ItemWarehouseLocation
		td= item.ItemID
		td= item.ItemQuantity
		td Test
		td= item.ItemDescription
		td= item.ItemUnitStock

mixin customerInfoPanel(order)
	.card
		.card-header
			h2.mb-0.text-right.card-title=order.InvoiceNumberPrefix + order.InvoiceNumber
		.card-body.collapse.show#orderInfo
			.row
				.col-12
					table.table.table-striped.table-hover.table-sm
						thead
							tr
								th Phone
								th Email
								th Order Date
								th Customer Type
						tbody.infoTableBody
							tr
								td= order.ShipmentList[0].ShipmentPhone
								td.email= order.BillingEmail
								td= moment(new Date(order.OrderDate)).format('dddd MMM Do, h:mm:ss a')
								td(id="customerType"+order.InvoiceNumberPrefix+order.InvoiceNumber)
					table.table.table-striped.table-hover.table-sm
						thead 
							tr
								th Payment Method
								th Items
								th Value
								th Ship Method
								th Ship Cost
						tbody.infoTableBody
							tr
								td= order.BillingPaymentMethod
								td(id="totalItems"+order.InvoiceNumberPrefix+order.InvoiceNumber)
								td= '$'+order.OrderAmount.toFixed(2)
								td= order.ShipmentList[0].ShipmentMethodName
								td= '$'+order.ShipmentList[0].ShipmentCost.toFixed(2)
			.row
				.col-lg-2.col-sm-2
					+billingAddress(order)
				.col-lg-2.col-sm-2
					+shippingAddress(order.ShipmentList[0])
				.col-lg-8.col-sm-8
					.row
						.col-lg-6.col-sm-6
							h4 Billing Status
							label.checkbox-inline.pr-2
								input(type="checkbox")
								|  Paid
							label.checkbox-inline
								input(type="checkbox")
								|  Declined
						.col-lg-6.col-sm-6
							h4 Ship Status
							label.checkbox-inline.pr-2
								input(type="checkbox")
								|  Back-Order
							label.checkbox-inline.pr-2
								input(type="checkbox")
								|  Pre-Order
							label.checkbox-inline
								input(type="checkbox")
								|  Picked
					.row.form-group
						.col-lg-4
							label Carrier / Package Type
							input(type="text" readonly).form-control
						.col-lg-4
							label Weight
							input(type="text" readonly).form-control
						.col-lg-4
							label Shipping Cost
							input(type="text" readonly).form-control
			
			if (order.CustomerComments)
				.row
					.col-lg-12.col-sm-12
						h4 Comments
						.well
							p=order.CustomerComments

mixin orderItemPanel(order)
	h3 Pick Sheet
	#pickSheet
		table.table.table-striped.table-hover(id="pickTable"+order.InvoiceNumberPrefix+order.InvoiceNumber).pick-table
			thead
				tr
					th.text-center(style="width:14%") Location
					th.text-center SKU
					th.text-center Ordered
					th.text-center Quantity Picked
					th.text-center Picked
					th(style="width:30%") Description
					th Stock Level
			tbody(id="pickTableBody"+order.InvoiceNumberPrefix+order.InvoiceNumber)

mixin orderSection(order)
	.container-fluid
		+customerInfoPanel(order)
	.container-fluid.pt-2
		+orderItemPanel(order)
	.pagebreak

doctype html
include mixins
html
	include includes/head
		title Pick Order
	body
		#wrapper
			+sidebarNav("pick-order")

			#page-content
				nav.navbar.navbar-light.bg-light.navbar-expand-sm.sticky-top
					button.btn.btn-secondary.btn-toggles(type="button").m-0.position-relative#left-menu-toggle
						i.far.fa-bars.fa-fw
					span.navbar-brand.mb-0.h1.pl-2#orderNavTitle 
					form.form-inline
						select.form-control#orderStatus
							option(value=1) New
							option(value=2) Processing
							option(value=3) Backorder
							option(value=6) Pre-order
							option(value=9) Awaiting Payment
							option(value=13) Awaiting Shipment
							option(value=4) Shipped
					span.navbar-text#orderInfo.ml-2
					ul.navbar-nav.ml-auto
						li.dropdown.nav-item
							button.dropdown-toggle.btn.btn-primary.mr-2(type="button" data-toggle="dropdown") Actions
							ul.dropdown-menu.dropdown-menu-right
								a(href="#").dropdown-item#fixBarcodeButton Fix Barcode
								a(href="#", data-toggle="modal", data-target="#fixLocationModal").dropdown-item#fixLocationButton Fix Location
						button.btn.btn-primary.mr-2(type="button")#startPickingButton Start Picking
						button.btn.btn-info.mr-2(type="button")#showSummaryButton Show Summary

						.btn-group
							button.btn.btn-success(type="button")#saveOrderButton Save
							button.btn.btn-success.dropdown-toggle.dropdown-toggle-split(type="button" data-toggle="dropdown")
							.dropdown-menu.dropdown-menu-right
								a.dropdown-item(href="#")#saveToSiteButton Save to 3D Cart
								a.dropdown-item(href="#")#saveToQuickbooks Save to QB

				.container.pt-3#summary
					if (order)
						+orderSection(order)
					else if (orders)
						for order in orders
							+orderSection(order)
					else
						h1 Error
				.container-fluid.pt-3#pickarea(style="display: none;")
					.row
						.col-7
							.row
								.col-12
									table.table
										thead
											tr
												th SKU
												th Description
												th Ordered
												th On-hand
												th Second Location
										tbody
											tr
												th#itemSku 12345
												td#itemDescription A cute die.
												th#itemQuantity
												td#itemQuantityOnHand
												th#itemSecondLocation
							.row
								.col-12.text-center
									.carousel.slide(data-ride="carousel")#productImageCarousel
										.carousel-inner#productCarousel
									a.carousel-control-prev(role="button", data-slide="prev", href="#productImageCarousel")
										i.far.fa-chevron-left(style="color: black;")
									a.carousel-control-next(role="button", data-slide="next", href="#productImageCarousel")
										i.far.fa-chevron-right(style="color: black;")
						.col-5
							.row
								.col-12.text-center
									h2 Proceed to the location
									h2.text-primary#itemLocation
							.row.mt-3
								.col-12.text-center
									h2#itemInstructions Scan the item
									h2.text-primary#itemSkuHeader
									.input-group#barcodeInput
										input(type="text").form-control-lg.form-control#itemBarcodeInput
										.input-group-append
											.input-group-text.text-white.bg-danger#barcodeInputGroup
												i.far.fa-times.fa-fw#barcodeIcon
							.row.mt-3
								.col-12.text-center
									h2 Items picked
									.input-group
										.input-group-prepend
											button.btn.btn-outline-primary(type="button")#minusButton
												i.far.fa-minus.fa-fw
										input.form-control-lg.form-control(type="number", step="1").text-center#itemQuantityPicked
										.input-group-append
											button.btn.btn-outline-primary(type="button")#plusButton
												i.far.fa-plus.fa-fw
							.row.mt-3
								.col-12.text-center
									button.btn.btn-lg.btn-secondary(type="button").mr-3#prevItemButton Previous
									button.btn.btn-lg.btn-success(type="button").mr-3#donePickingButton Done
									button.btn.btn-lg.btn-secondary(type="button")#nextItemButton Next



		+footer

	#fixBarcodeModal.modal.fade(role="dialog")
		.modal-dialog.modal-lg(role="document")
			.modal-content
				.modal-header
					h4 Fix Barcode
					button.close(data-dismiss="modal") &times;
				.modal-body
					.row.form-group
						.col-12
							label(for="newBarcode") New Barcode
							input#newBarcode.form-control(type="text")
				.modal-footer
					button.btn.btn-success#saveBarcodeModal(type="button") Save
					button.btn.btn-secondary(type="button", data-dismiss="modal") Close

	#fixLocationModal.modal.fade(role="dialog")
		.modal-dialog.modal-lg(role="document")
			.modal-content
				.modal-header
					h4 Fix Location
					button.close(data-dismiss="modal") &times;
				.modal-body
					.row.form-group
						.col-12
							label(for="newLocation") New Location
							input#newLocation.form-control(type="text")
				.modal-footer
					button.btn.btn-success#saveLocationModal(type="button") Save
					button.btn.btn-secondary(type="button", data-dismiss="modal") Close
		
		script(type="text/javascript", src="js/moment.js")
		script(type="text/javascript", src="js/pick-order.js")
		if (order)
			script.
				$(document).ready(e => {
					buildPickTable(!{JSON.stringify(order)})
				});