mixin billingAddress(customer)
  address
    h3 Billing
    strong=customer.name
    br
    if (customer.companyName)
      strong=customer.companyName
      br 
    =customer.billingAddress
    br
    if (customer.billingAddress2)
      =customer.billingAddress2
      br
    =customer.billingCity + ", " + customer.billingState
    br
    =customer.billingCountry + ", " + customer.billingZipCode

mixin shippingAddress(shippingInfo)
  address
    h3 Shipping
    strong=shippingInfo.ShipmentFirstName + " " + shippingInfo.ShipmentLastName
    br
    if (shippingInfo.ShipmentCompany)
      strong=shippingInfo.ShipmentCompany
      br
    =shippingInfo.ShipmentAddress
    br
    if (shippingInfo.ShipmentAddress2)
      =shippingInfo.ShipmentAddress2
      br
    =shippingInfo.ShipmentCity + ", " + shippingInfo.ShipmentState
    br
    =shippingInfo.ShipmentCountry + ", " + shippingInfo.ShipmentZipCode

mixin itemRow(item)
  tr
    td=item.item.sku
    td=item.quantity
    td=item.pickedQuantity
    td=item.item.name
    - let price = item.price ? 0;
    td='$' + price.toFixed(2)
    td='$' + (price * item.pickedQuantity).toFixed(2)

mixin unsentItemRow(item)
  tr
    td=item.item.sku
    td=item.item.name
    td=item.quantity
    td='$' + item.price
    td=item.item.discontinued ? 'Discontinued' : 'Not in stock'
    td=(item.item.availableForBackorder && !item.item.discontinued) ? 'Yes' : 'No'

mixin customerInfoPanel(order)
  .row
    .col
      p.lead Thank you for shopping at Ecstasy Crafts!
  h2= order.orderId
  .row
    .col-12
      table.table.table-striped.table-hover.table-sm
        thead
          tr
            th Phone
            th Email
            th Order Date
            th Customer Type
        tbody.infoTableBody
          tr
            td= order.cartOrder.ShipmentList[0].ShipmentPhone
            td.email= order.cartOrder.BillingEmail
            td= moment(new Date(order.orderDate)).format('dddd MMM Do, h:mm:ss a')
            if order.customer.canadian
              if (order.customer.customerType == 0)
                td Retail
              else if (order.customer.customerType == 19)
                td Premier Member
              else
                td Wholesale
            else
              if (order.customer.customerType == 0)
                td Retail
              else if (order.customer.customerType == 18)
                td Premier Member
              else
                td Wholesale
  .row
    .col-lg-2.col-sm-2
      +billingAddress(order.customer)
    .col-lg-2.col-sm-2
      +shippingAddress(order.cartOrder.ShipmentList[0])
    .col-8
      table.table.table-striped.table-hover.table-sm
        thead 
          tr
            th Items Ordered
            th Items Shipped
            th Ship Method
            th Payment Method
        tbody.infoTableBody
          tr
            td= order.numberOfItems
            td= order.numberOfItemsPicked
            td= order.cartOrder.ShipmentList[0].ShipmentMethodName
            td= order.cartOrder.BillingPaymentMethod

  if (order.cartOrder.CustomerComments)
    .row
      .col-lg-12.col-sm-12
        h4 Comments
        .well
          p=order.cartOrder.CustomerComments

mixin orderItemPanel(order)
  #pickSheet
    .row
      - let unsentItems = false;
      .col
        table.table.table-striped.table-hover.pick-table
          thead
            tr
              th SKU
              th Ordered
              th Shipped
              th Description
              th Price
              th Line Total
          tbody
            each item in order.items
              if (item.pickedQuantity > 0)
                +itemRow(item)
              else
                - unsentItems = true;
            tr
              th
              th
              th
              td Shipping &amp; Handling
              td= '$' + (order.shippingCost ? order.shippingCost.toFixed(2) : '0.00')
              td= '$' + (order.shippingCost ? order.shippingCost.toFixed(2) : '0.00')
            if (order.discount > 0)
              tr
                th
                th
                th
                td Discounts
                td = '$' (order.discount ? order.discount.toFixed(2) : '0.00')
                td = '$' (order.discount ? order.discount.toFixed(2) : '0.00')
            tr
              td
              td
              td
              td Sales Tax
              td='$' + order.salesTax.toFixed(2)
              td='$' + order.salesTax.toFixed(2)
            tr
              th
              th
              th
              th Total
              th
              th= '$' + (order.subtotal + order.salesTax).toFixed(2)
    if (unsentItems)
      .row
        .col
          h3 Items not sent
          table.table.table-striped.pick-table
            thead
              tr
                th SKU
                th Description
                th Ordered
                th Price
                th Reason
                th Backordered
            tbody
              each item in order.items
                if (item.pickedQuantity == 0)
                  +unsentItemRow(item)

mixin orderSection(order)
  .container
    +customerInfoPanel(order)
  .container.pt-2
    +orderItemPanel(order)
  .pagebreak

doctype html
include mixins
html
  include includes/head
    title Packing Slips
  body
    #wrapper
      +sidebarNav("packing")

      #page-content
        +menuToggle
        .container.pt-3
        if (batch)
          each order in batch.orders
            if (order.toPrint)
              +orderSection(order)
        else if (order)
          +orderSection(order)
    +footer